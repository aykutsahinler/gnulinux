<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport"
          content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Use the title from a page's frontmatter if it has one -->
    <title>Hafta 3 - Server kavramının açıklanması, SSH Kullanımı, Zamanlanmış görevler oluşturulması</title>
    <link href="/stylesheets/site.css" rel="stylesheet" />
    <script src="/javascripts/site.js"></script>
  </head>
  <body>
    <nav class="navbar">
      <div class="homepage">
        <a href="http://lvh.me:4567/">Herkes için GNU/Linux</a>
      </div>
      <div class="authors">
        <div class="author">
          <a href="https://github.com/boratanrikulu/" target="_blank">Bora Tanrıkulu</a>
        </div>
        <div class="author">
          &#8226;
        </div>
        <div class="author">
          <a href="https://github.com/hasantezcan/" target="_blank">Hasan Tezcan</a>
        </div>
      </div>
    </nav>
    <header>
        <a href="http://lvh.me:4567">
          <div class="site-logo">
            <img src="logo.png" alt="pausiber-logo" height="200">
          </div>
        </a>
        <div class="site-title">
          <h1>
            Herkes için GNU/Linux - PaüSiber
          </h1>
          <p class="site-desc">
            topluluğumuz tarafından eğitimi verilen "Herkes için GNU/Linux" kursunun dokümanlarını içerir.
          </p>
        </div>
    </header>
      <section class="container">
    <article class="article">
      <hr>
      <h2 id="hafta-3-server-kavram-n-n-a-klanmas-ssh-kullan-m-zamanlanm-g-revler-olu-turulmas">Hafta 3 - Server kavramının açıklanması, SSH Kullanımı, Zamanlanmış görevler oluşturulması</h2>

<p><strong>Amaç :</strong> Server kavramının açıklanması, SSH Kullanımı, Zamanlanmış görevler oluşturulması</p>

<h2 id="server-sunucu-nedir">Server (Sunucu) Nedir ?</h2>

<p>Server denince akıllara -filimlerin de etkisiyle- devasa büyüklükte hangarlar içine sıra sıra istiflenmiş, genelde siyah renkte dolaplar içinde bulunan, dikdörtgen şeklinde çekmeceler geliyor.</p>

<p>Evet, akıllara gelen bu tablo ve tanım tamamen doğru. Fakat bir <q>server</q> oluşturmak için tüm bu saydığımız şeylere ihtiyacımız yok. Sadece bir bilgisayar, server oluşturmak için yeterli. Ve tabiki gerekli olan bir iletişim ağı.</p>

<p align="center">
    <img alt="pwd" src="/images/hafta-3/0.jpg" width="800">
</p>

<p>Yani server dediğimiz şeylerde aslında birer bilgisayardır.</p>

<p>Bir bilgisayarın server olarak çalışabilmesi için; gerekli bazı yazılımlara ve kullandığı verileri iletim ağına itebilecek - çekebilecek güce sahip olması gerekir.</p>

<p>Bu <strong>güç</strong> bazen en başta anlattığımız o hollywood vari tablodaki serverların gücü gibi devasa bir güce sahip olurken, bazen de 20 dolarlık bir bilgisayar olan Raspberry Pi&#39;ın gücü olabilir.</p>

<p>Server&#39;ları yönetmek için her durumda fiziksel olarak müdahale edemeyiz. Uzaktan erişip yönetmemiz gerekir. Bu gibi durumlarda <strong>SSH protokolü</strong> kullanır.</p>

<hr>

<h2 id="ssh-protokol-nedir">SSH Protokolü Nedir ?</h2>

<p>SSH (Secure Shell), ağ üzerinde bulunan bir sunucuya bağlanmaya ve bağlanılan sunucu üzerinde komut çalıştırma, dosya transferi gibi işlemleri gerçekleştirmeye olanak sağlayan bir uzak sunucu bağlantı protokolüdür.</p>

<p>SSH protokolü; komut çalıştırma, dosya transferi gibi işlemlerin dışında, güvenli iletişim kanalları gerektiren durumların tamamında kullanılabilmektedir. Örneğin, POP3 mail protokolü gibi iletişimini şifrelenmemiş şekilde gerçekleştiren servisler SSH üzerinden aktarılarak şifreli ve güvenli duruma getirilebilirler.</p>

<hr>

<h4 id="ssh-kullan-m">SSH Kullanımı</h4>

<p>SSH&#39;ın genel olarak kullanımı oldukça basittir. Aşağıdaki gibi bir yapı ile uzak server&#39;ımıza; kullanıcı adı ve parola bilgisini kullanarak erişebiliriz.</p>
<div class="highlight"><pre class="highlight plaintext"><code>    [~$] ssh kullancı_adı@server_ip
</code></pre></div>
<p>SSH&#39;ın varsayılan port&#39;u 22&#39;dir. Fakat genellikle -her ne kadar gerekliliği tartışılsa da- sunucularda bu port güvenlik sebebi ile değiştirilmektedir. Bağlantı sağlanırken, sunucunun SSH bağlantısını kabul etmek amacıyla dinlediğini port&#39;u belirtmek için <strong><code>-p</code></strong> parametresi kullanılır.</p>
<div class="highlight"><pre class="highlight plaintext"><code>    [~$] ssh kullancı_adı@server_ip -p port
</code></pre></div>
<hr>

<h4 id="parola-ile-ba-lant-kurmak-neden-g-venli-de-il">Parola ile Bağlantı Kurmak Neden Güvenli Değil ?</h4>

<p>Az önce kullanıcı adı ve parola bilgisi sağlayan uzakta bulunan server&#39;ımıza erişim sağladık. Fakat sizce bu güvenli mi ?</p>

<p>Bizim açımıza göre server&#39;ımıza <strong>parola ile uzaktan bağlanmak güvenli bir yöntem değildir.</strong></p>

<p>Bunun belli başlı sebepleri vardır; ssh bağlantısının bruteforce işlemine açık olması, herkese açık ortamlarda parolanın elle girilmesi uzaktan izleyen kişiler tarafından parolanın tespit edilmesine yol açabilecek olması gibi faktörler örnek verilebilir.</p>

<p>Bu yüzden, server&#39;ımıza erişim sağlarken, ssh-key kullanmamız daha kullanışlı ve güvenli olacaktır.</p>

<hr>

<h4 id="ssh-key-nedir">SSH-Key Nedir ?</h4>

<p>SSH-Key, parola kullanmadan SSH bağlantıları sağlayabilmemizde kullanılan public ve private key çiftine denir.</p>

<hr>

<h4 id="ssh-keygen-ile-key-olu-turulmas">SSH-Keygen ile Key Oluşturulması</h4>

<p>SSH-Key oluşturmak oldukça basittir. Aşağıdaki komutu yürüttüğünüzde size bir kaç soru sorduktan sonra key üretilecektir. Key üretimi sonucunda biri <strong>public</strong> diğeri <strong>private</strong> olmak üzere <strong>iki adet key</strong> oluşacaktır.</p>
<div class="highlight"><pre class="highlight plaintext"><code>    [~$] ssh-keygen
</code></pre></div>
<p align="center">
    <img alt="ssh-keygen" src="/images/hafta-3/1.png" width="800">
</p>

<p>Üretilen keyler&#39;den sonunda <strong>.pub</strong> uzantısı bulunan sizin public key&#39;inizdir. Bu key&#39;i bağlanmak istediğiniz sunuculara eklemeniz gerekir. Biz bu anlatımda sunucu tarafına değinmeyecemiz için bu adımın nasıl uygulanacağını öğrenmek isteyen arkadaşların bu anlatıma bakmasını tavsiye ederiz : <a href="https://boratanrikulu.me/ssh-key-kullanimi/"><strong><code>boratanrikulu.me/ssh-key-kullanimi</code></strong></a></p>

<p>Uzantısı bulunmayan key ise sizin private key&#39;inizdir. Bu dosyayı kimse ile paylaşmamalısınız. SSH ile bağlantı sağlarken bu dosyayı kullanacağız.</p>

<p>Ek olarak private key&#39;in izinleri <strong>600</strong> olarak ayarlanmalıdır.<br>
Bunu uygulamak için önceki haftanın dokümanını inceleyin : <a href="/hafta2/hafta2.md"><strong><code>hafta2.md</code></strong></a></p>

<hr>

<h4 id="ssh-key-kullanarak-ba-lant-sa-lanmas">SSH-Key Kullanarak Bağlantı Sağlanması</h4>

<p>SSH-Key kullanarak bağlantı sağlamak için <strong><code>-i</code></strong> parametresi kullanılmalıdır.</p>
<div class="highlight"><pre class="highlight plaintext"><code>    [~$] ssh -i /path/to/private_key kullancı_adı@server
</code></pre></div>
<hr>

<h4 id="ssh-config-dosyas-n-n-kullan-m"><q>.ssh/config</q> Dosyasının Kullanımı</h4>

<p>Eğer birden fazla sunucu ile uğraşıyorsanız, her bağlantı kurma aşamasında IP girmek tam bir işkence. Bunun önüne geçmek için bilgisayarınızda aşağıdaki gibi bir <strong><code>${HOME}/.ssh/config</code></strong> dosyası oluşturabilirsiniz. Bu sayede IP&#39;leri girmeden direkt olarak <strong><code>ssh server_name</code></strong> diyerek sunucunuz ile bağlantı sağlayabilirsiniz.</p>

<p>Bunun için <strong><code>${HOME}/.ssh/config</code></strong> dosyasını oluşturun.</p>
<div class="highlight"><pre class="highlight plaintext"><code>    [~$] touch ${HOME}/.ssh/config
</code></pre></div>
<p>Ardından dosya içeriğini aşağıdaki yapıya uygun şekilde ayarlayın.</p>
<div class="highlight"><pre class="highlight plaintext"><code>    Host    server_name
        HostName        server_ip
        User            username
        Port            22
        IdentityFile        /path/to/ssh-key
</code></pre></div>
<p>Artık herhangi bir şekilde IP girmek yerine direkt olarak <strong><code>ssh server_name</code></strong> diyerek sunucunuza bağlanabilirsiniz.</p>

<hr>

<h2 id="zamanlanm-g-rev-nedir">Zamanlanmış Görev Nedir ?</h2>

<p>Zamanlanmış görevler sayesinde günlük-haftalık-aylık-yıllık periyotlar ile yapmanız gereken işlemleri manuel yapmak yerine otomatik olarak istenen zaman diliminde gerçekleşmesini sağlayabilirsiniz.</p>

<p>Zamanlanmış görevler için çoğunlukla <strong>cron</strong> kullanılır. Çoğu sistemde cron kurulu olarak gelmektedir. Ayrıca yine çoğu sistemde default olarak gelen bazı zamanlanmış cron görevleri mevcuttur.<br>
Bunlar <strong>/etc/</strong> altında aşağıdaki gibi bulunur.</p>

<p align="center">
    <img src="/images/hafta-3/cron-ile-zamanlanmis-gorevler/3.png">
</p>

<hr>

<h2 id="cron-nedir">Cron Nedir ?</h2>

<p>Cron zamanlanmış olarak komutları çalıştırmamızı sağlayan bir daemon&#39;dur. Çoğu linux dağıtımında yüklü olarak gelir.</p>

<p>Cron kullanımı için iki temel yol vardır.</p>

<p>Birincisi; hali hazırda sistemde /etc/ altında bulunan <strong>cron.daily</strong>, <strong>cron.hourly</strong>, <strong>cron.monthly</strong> ve <strong>cron.weekly</strong> klasörlerinine istenen script&#39;in konulmasıdır.</p>

<p>Bu klasörlerde bulunan scriptler, <strong>/etc/crontab</strong>&lsquo;daki ayarlamaya göre ilgili zaman dilimlerinde çalıştırılır.</p>

<p>/etc/crontab aşağıdaki gibidir.</p>

<p align="center">
    <img src="/images/hafta-3/cron-ile-zamanlanmis-gorevler/4.png">
</p>

<p>İkinicisi; kullanıcıya özel crontab dosyası oluşturulmasıdır. Biz anlatımızda ikinci yolu tercih edeceğiz.</p>

<hr>

<h4 id="sunucuda-saat-ayarlamas-n-n-yap-lmas">Sunucuda Saat Ayarlamasının Yapılması</h4>

<p>Eğer zamanlanmış bir görev yapmak istiyorsanız ilk yapanız gereken, elinizde bulunan sunucunun sistem saatinin istediğiniz gibi olduğundan emin olmaktır. Sistem saatini aşağıdaki komut ile kontrol edebilirsiniz.</p>
<div class="highlight"><pre class="highlight plaintext"><code>    [~$] date
</code></pre></div>
<p>Eğer istenenden farklı bir sonuç gözleniyor ise aşağıdaki komut ile sistem saatini bölgesel olarak yeniden ayarlayabilirsiniz.</p>
<div class="highlight"><pre class="highlight plaintext"><code>    [~#] dpkg-reconfigure tzdata
</code></pre></div>
<p align="center">
    <img src="/images/hafta-3/cron-ile-zamanlanmis-gorevler/1.png">
</p>

<p align="center">
    <img src="/images/hafta-3/cron-ile-zamanlanmis-gorevler/2.png">
</p>

<hr>

<h4 id="crontab-kullan-m">Crontab Kullanımı</h4>

<p>Her kullanıcının kendisine ait bir crontab dosyası vardır.  </p>

<p><strong>Crontab</strong> ile bir crontab dosyası oluşturulduğunda bu dosyalar <strong>/var/spool/cron/crontabs/</strong> altında tutulur. Bu dosyalara elle müdahale edilmemesi gerekir, bunun yerine <strong><code>crontab</code></strong> komutu kullanılmalıdır.</p>

<p>Crontab komutunun kullanım paremetreleri aşağıdaki gibidir.</p>

<table><thead>
<tr>
<th style="text-align: center">Komut</th>
<th style="text-align: center">Açıklama</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: center"><strong><code>crontab -l</code></strong></td>
<td style="text-align: center">Komudu çalıştıran kullacının, eğer mevcut ise, crontab dosyasını gösterir</td>
</tr>
<tr>
<td style="text-align: center"><strong><code>crontab -e</code></strong></td>
<td style="text-align: center">Komudu çalıştıran kullanıcının, crontab dosyasını açar</td>
</tr>
<tr>
<td style="text-align: center"><strong><code>crontab -r</code></strong></td>
<td style="text-align: center">Komudu çalıştıran kullanıcının crontab dosyasını siler</td>
</tr>
<tr>
<td style="text-align: center"><strong><code>crontab -u user_name -e</code></strong></td>
<td style="text-align: center">Başka bir kullanıcının crontab dosyasını açar</td>
</tr>
</tbody></table>

<p>Crontab dosyasını bir kullanıcı için oluşturmak ve düzenlemek istiyorsak <strong>-e</strong> parametresini kullanmamız gerekir. Eğer ilk defa oluşturuluyorsa aşadağıki gibi boş - varsayılan bir crontab dosyası oluşacaktır.</p>
<div class="highlight"><pre class="highlight plaintext"><code>    [~$] EDITOR=nano crontab -e
</code></pre></div>
<p align="center">
    <img src="/images/hafta-3/cron-ile-zamanlanmis-gorevler/11.png">
</p>

<p>Crontab dosya yapısı aşağıdaki yapıdaki gibi kullanılmalıdır. Her satıra bir işlem yazılacak şekilde düzenlenmelidir.</p>

<p align="center">
    <img src="/images/hafta-3/cron-ile-zamanlanmis-gorevler/10.png">
</p>

<p>Yukardaki ifade yerine direkt olarak aşağıdaki gibi bir yapı da kullanılabilir.</p>

<table><thead>
<tr>
<th style="text-align: center">Komut</th>
<th style="text-align: center">Eşiti</th>
<th style="text-align: center">Açıklama</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: center"><strong><code>@yearly</code></strong></td>
<td style="text-align: center">0 0 1 1 *</td>
<td style="text-align: center">Her yılın ilk günü çalışır</td>
</tr>
<tr>
<td style="text-align: center"><strong><code>@monthly</code></strong></td>
<td style="text-align: center">0 0 1 * *</td>
<td style="text-align: center">Her ayın ilk günü çalışır</td>
</tr>
<tr>
<td style="text-align: center"><strong><code>@weekly</code></strong></td>
<td style="text-align: center">0 0 * * 0</td>
<td style="text-align: center">Her hafta pazar günü çalışır</td>
</tr>
<tr>
<td style="text-align: center"><strong><code>@daily</code></strong></td>
<td style="text-align: center">0 0 * * *</td>
<td style="text-align: center">Her gün gece yarısı çalışır</td>
</tr>
<tr>
<td style="text-align: center"><strong><code>@hourly</code></strong></td>
<td style="text-align: center">0 * * * *</td>
<td style="text-align: center">Her saatin başlangıcında çalışır</td>
</tr>
<tr>
<td style="text-align: center"><strong><code>@reboot</code></strong></td>
<td style="text-align: center"><strong>-karşılığı yok-</strong></td>
<td style="text-align: center">Her başlatma işleminde çalışır</td>
</tr>
</tbody></table>

<p>Örneğin aşağıdaki iki satır da aynı işlemi yapmaktadır.</p>

<p align="center">
    <img src="/images/hafta-3/cron-ile-zamanlanmis-gorevler/12.png">
</p>

<hr>

<h2 id="d-zenli-olarak-serverden-verileri-ekecek-beti-in-yaz-m">Düzenli Olarak Server&#39;den Verileri Çekecek Betiğin Yazımı</h2>

<p>Hadi şimdi şuana kadar öğrendiğimiz SSH ve CRON bilgilerimizi harmanlayalım.</p>

<p>Elimizde 192.168.1.101 ip&#39;li bir sunucu olduğunu düşünelim. Bu sunucun developer kullanıcısın Home dizi altında <strong>gnulinux</strong> isimli, eğitim dokümanlarını içeren bir klasör olsun.</p>

<p>Senaryomuzda bu sunucuya her hafta pazartesi saat 23:50&#39;de SSH-Key ilgili dizini kendi bilgisayarımızda bulunan Documents/egitim/ dizini içersine kaydetmek istiyor olalım.</p>

<p>Bunun için aşağıdaki gibi bi betik yazdım. Yapısını oldukça basit. Betiğini okuduğunuzda <strong><code>scp</code></strong> komutunu göreceksiniz. SCP, ssh protokolü üzerinden dosya transferi yapabilmemize olanak veren bir programdır. Detaylı olarak kullanımına bakmak için <strong><code>tldr scp</code></strong> yapabilirsiniz.</p>

<p>Aşağıdaki betiğin bilgisayarınızda bir yere kayıt edip, çalıştırmak iznini <strong><code>+x</code></strong> verin.
&ldquo;`sh
    #!/bin/sh</p>

<p>username=<q>developer</q>
    server_ip=<q>192.168.1.101</q>
    key_path=<q>${HOME}/keys/private_key</q>
    remote_path=<q>gnulinux</q>
    local_path=<q>${HOME}/Documents/egitim/</q></p>

<p>scp -i ${key_path} -r ${username}@${server_ip}:${remote_path} ${local_path}
&rdquo;`</p>

<p>Şimdi aşağıdaki komut ile yeni bir crontab oluşturalım.</p>
<div class="highlight"><pre class="highlight plaintext"><code>    [~$] EDITOR=nano crontab -e
</code></pre></div>
<p>Betiğimizi her hafta pazartesi saat 23:50&#39;de çalıştırmak istediğimiz için, aşağıdaki satırı crontab dosyasını ekleyip kaydetmemiz yeterli.</p>
<div class="highlight"><pre class="highlight plaintext"><code>    50 23 * * 1 sh /path/to/betik.sh
</code></pre></div>
    </article>
  </section>

  </body>
</html>
